extend layout

block content
    form#book-form
        select#selectField(required='' method='post' onchange='getSchedule()')  
            option(value='' disabled='' selected='') Choose professor...
            option(value='Daniel Barbara') Daniel Barbara	 
            option(value='Ivan Avramovic') Ivan Avramovic
            option(value='Daniel Brodsky') Daniel Brodsky
            option(value='Larry Kerschberg') Larry Kerschberg
            option(value='Foteini Baldimtsi') Foteini Baldimtsi
            option(value='Zoran Duric') Zoran Duric
            option(value='Jeff Ouffutt') Jeff Ouffutt
            option(value='Hakan Aydin') Hakan Aydin
            option(value='Socrates Dimitriadis') Socrates Dimitriadis

    .bg-modal
        .modal-content
            h2(style='margin-top: 50px;') Please select time interval [ 0 - 15m, 15 - 30m, 30 - 45m, 45 - 60m ]
            #officeHourDate
            #schedule
    iframe(name='hiddenFrame' id='hiddenFrame' width='0' height='0' border='0' style='display: none;')
    //- load options list but from js, based on that post (show post button and the stuff above only after choosing...)
    //- ^^ so it's a form (when posted--post request)
    //- in js file just make an event listener of onchange 
    script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
    script.
        function getSchedule(){
            var scheduleField = document.getElementById('schedule');
            var select = document.getElementById('selectField');
            var selectedValue = select.options[select.selectedIndex].value;
            console.log("selected value is: " + selectedValue);
            axios({
                method:'get',
                url:'http://localhost/user/booking/professor',
                params:{
                    professor: selectedValue
                }
            })
            .then((response) => { // make if statement--if undefined (object object) then present nothing
                // otherwise, present dropdown

                var sch1 = response.data[0].schedule1;
                var sch2 = response.data[0].schedule2;
                var sch3 = response.data[0].schedule3;
                var sch4 = response.data[0].schedule4;

                if(!sch1)
                    sch1 ="disabled";
                else
                    sch1 ="";

                if(!sch2)
                    sch2 ="disabled";
                else
                    sch2 ="";

                if(!sch3)
                    sch3 ="disabled";
                else
                    sch3 ="";

                if(!sch4)
                    sch4 ="disabled";
                else
                    sch4 ="";

                

                scheduleField.innerHTML="<form id='subform'><select id='register' target='hiddenFrame'><option " + sch1 + " value='1'>0 mins</option><option " + sch2 + " value='2'>15 mins</option><option " + sch3 + " value='3'>30 mins</option> <option " + sch4 +  " value='4'>45 mins</option></select><textarea id='message' placeholder='Please include questions or topics you will discuss...'></textarea><input role='button' type='submit' value='Submit' id='submitBtn'/></form>"
                
                

                
                // works with click but not submit

                document.getElementById('subform').addEventListener('submit', (evt) => updateSchedule(evt));
                function updateSchedule(evt){
                    //evt.preventDefault();
                    //alert(response.data[0].schedule1);
                    
                    var registerInterval = document.getElementById('register');
                    var textMessage = document.getElementById('message').value;
                    var selectedInterval = registerInterval.options[registerInterval.selectedIndex].value;
                    
                    var newSchedule1 = response.data[0].schedule1; 
                    var newSchedule2 = response.data[0].schedule2; 
                    var newSchedule3 = response.data[0].schedule3; 
                    var newSchedule4 = response.data[0].schedule4; 
                    var msg1 = response.data[0].text1;
                    var msg2 = response.data[0].text2;
                    var msg3 = response.data[0].text3;
                    var msg4 = response.data[0].text4;

                    if(selectedInterval == '1'){
                        newSchedule1 = false;
                        msg1 = textMessage;
                    }
                    if(selectedInterval == '2'){
                        newSchedule2 = false;
                        msg2 = textMessage;
                    }
                    if(selectedInterval == '3'){
                        newSchedule3 = false;
                        msg3 = textMessage;
                    }
                    if(selectedInterval == '4'){
                        newSchedule4 = false;
                        msg4 = textMessage;
                    }

                    console.log("in");

                    axios({
                        method:'put',
                        url:'http://localhost/user/booking',
                        params:{
                            professor: selectedValue,
                            schedule1: newSchedule1,
                            text1: msg1,
                            schedule2: newSchedule2,
                            text2: msg2,
                            schedule3: newSchedule3,
                            text3: msg3,
                            schedule4: newSchedule4,
                            text4: msg4
                        }
                    })
                }
                
            })
        }
        
