extend layout

block content
    form#book-form
        select#selectField(required='' method='post' onchange='getSchedule()' class='selectClassDes')  
            option(value='' disabled='' selected='') Choose professor...
            option(value='Daniel Barbara') Daniel Barbara	 
            option(value='Ivan Avramovic') Ivan Avramovic
            option(value='Daniel Brodsky') Daniel Brodsky
            option(value='Larry Kerschberg') Larry Kerschberg
            option(value='Foteini Baldimtsi') Foteini Baldimtsi
            option(value='Zoran Duric') Zoran Duric
            option(value='Jeff Ouffutt') Jeff Ouffutt
            option(value='Hakan Aydin') Hakan Aydin
            option(value='Socrates Dimitriadis') Socrates Dimitriadis

    .bg-modal
        .modal-content
            #officeHourDate
            #schedule
    //- load options list but from js, based on that post (show post button and the stuff above only after choosing...)
    //- ^^ so it's a form (when posted--post request)
    //- in js file just make an event listener of onchange 
    script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
    script.
        function getSchedule(){
            var doc = document.getElementById('selectField');
            doc.classList.remove('selectClassDes');
            var date = document.getElementById('officeHourDate');
            var scheduleField = document.getElementById('schedule');
            var select = document.getElementById('selectField');
            var selectedValue = select.options[select.selectedIndex].value;
            console.log("selected value is: " + selectedValue);
            axios({
                method:'get',
                url:'http://localhost/user/booking/professor',
                params:{
                    professor: selectedValue
                }
            })
            .then((response) => { // make if statement--if undefined (object object) then present nothing
                // otherwise, present dropdown

                var sch1 = response.data[0].schedule1;
                var sch2 = response.data[0].schedule2;
                var sch3 = response.data[0].schedule3;
                var sch4 = response.data[0].schedule4;

                if(!sch1)
                    sch1 ="disabled";
                else
                    sch1 ="";

                if(!sch2)
                    sch2 ="disabled";
                else
                    sch2 ="";

                if(!sch3)
                    sch3 ="disabled";
                else
                    sch3 ="";

                if(!sch4)
                    sch4 ="disabled";
                else
                    sch4 ="";

                var str = response.data[0].day;
                var timearr = str.split(" ");
                var time = timearr[1];
                var time1 = time.split(":");

                var hour = time1[0];
                
                var hourNumber = Number(hour);

                date.innerHTML="<h1 style='margin-top: 30px; margin-bottom: 30px;'>Please select an available time slot for " + response.data[0].day + " - " + (hourNumber + 1) + ":00" + ": </h1>"
                
                scheduleField.innerHTML="<form id='subform'><select id='register' required><option " + sch1 + " value='1'>" + hourNumber + ":00" + " - " + hourNumber + ":15"+" </option><option " + sch2 + " value='2'>" + hourNumber + ":15" + " - " + hourNumber + ":30"+ "</option><option " + sch3 + " value='3'>" + hourNumber + ":30" + " - " + hourNumber + ":45"+ "</option><option " + sch4 +  " value='4'>" + hourNumber + ":45" + " - " + (hourNumber + 1) + ":00"+ "</option></select><textarea id='message' placeholder='Please include questions or topics you will discuss...' class='class-input form-control comp-input input-lg' style='resize:none; margin-top:15px; margin-bottom:15px;' required></textarea><input role='button' type='submit' value='Submit' id='submitBtn'/></form>"
                
                var list = document.getElementById('register');
                list.options[value='default'].remove();

                
                // works with click but not submit

                document.getElementById('subform').addEventListener('submit', (evt) => updateSchedule(evt));
                function updateSchedule(evt){
                    //evt.preventDefault();
                    //alert(response.data[0].schedule1);
                    
                    var registerInterval = document.getElementById('register');
                    var textMessage = document.getElementById('message').value;
                    var selectedInterval = registerInterval.options[registerInterval.selectedIndex].value;
                    
                    var newSchedule1 = response.data[0].schedule1; 
                    var newSchedule2 = response.data[0].schedule2; 
                    var newSchedule3 = response.data[0].schedule3; 
                    var newSchedule4 = response.data[0].schedule4; 
                    var msg1 = response.data[0].text1;
                    var msg2 = response.data[0].text2;
                    var msg3 = response.data[0].text3;
                    var msg4 = response.data[0].text4;

                    if(selectedInterval == '1'){
                        newSchedule1 = false;
                        msg1 = textMessage;
                    }
                    if(selectedInterval == '2'){
                        newSchedule2 = false;
                        msg2 = textMessage;
                    }
                    if(selectedInterval == '3'){
                        newSchedule3 = false;
                        msg3 = textMessage;
                    }
                    if(selectedInterval == '4'){
                        newSchedule4 = false;
                        msg4 = textMessage;
                    }

                    console.log("in");

                    axios({
                        method:'put',
                        url:'http://localhost/user/booking',
                        params:{
                            professor: selectedValue,
                            schedule1: newSchedule1,
                            text1: msg1,
                            schedule2: newSchedule2,
                            text2: msg2,
                            schedule3: newSchedule3,
                            text3: msg3,
                            schedule4: newSchedule4,
                            text4: msg4
                        }
                    })
                }
                
            })
        }
        
